---
title: "pet proj"
author: "cchel"
date: "2023-11-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE,
                  	warning = FALSE)
```

```{r}
library(tidyverse)
library(dplyr)
library(lubridate)
library(stringr)
```

```{r}
seattle <- read_delim("../final project/datasets/Seattle_Pet_Licenses.csv",
                      show_col_types = FALSE)
```

Original Seattle Dataset:
```{r}
problems(seattle)
head(seattle)
```



```{r}
seattle[23773, 7] <- 98104

head(seattle)
```


Original NYC Dataset:
```{r}
nyc <- read_delim("../final project/datasets/NYC_Dog_Licensing_Dataset_20231129.csv",
                  show_col_types = FALSE)
head(nyc)
tail(nyc)
```

Standardizing capitalization for Seattle Dataset:

```{r}
seattle <- seattle %>% 
  mutate(`Animal's Name` = str_to_title(`Animal's Name`))

head(seattle)
```

Standardizing capitalization for NYC Dataset:
```{r}
nyc <- nyc %>% 
  mutate(AnimalName = str_to_title(AnimalName))

head(nyc)
```

Standardizing dates for Seattle Dataset:
```{r}
seattle <- seattle %>% 
  mutate(date = str_replace_all(seattle$`License Issue Date`,
                                c("January" = "01", "February" = "02", "March" = "03",
                                  "April" = "04", "May" = "05", "June" = "06",
                                  "July" = "07", "August" = "08", "September" = "09",
                                  "October" = "10", "November" = "11", "December" = "12"))) %>% 
  mutate(Date = mdy(date))

head(seattle)
```


Standardizing Dates for NYC dataset:
```{r}
nyc <- nyc %>%
  mutate(date = mdy(LicenseIssuedDate))

head(nyc)
```

Adjusted Column Names for Seattle:
```{r}
seattle <- seattle %>%
  mutate(ZipCode = `ZIP Code`) %>% 
  mutate(Breed = `Primary Breed`) %>% 
  mutate(Name = `Animal's Name`) %>% 
  select(Date, ZipCode, Breed, Name)

head(seattle)
```


Adjusted Column Names for NYC:
```{r}
nyc <- nyc %>%
  mutate(Date = date) %>% 
  mutate(Breed = BreedName) %>%
  mutate(Name = AnimalName) %>% 
  select(Date, ZipCode, Breed, Name)
head(nyc)
```

Adjusting Size for Seattle:
```{r}
seattle <- seattle %>% 
  tail(40000)

head(seattle)
```

Adjusting Size for NYC:
```{r}
nyc <- nyc %>% 
  tail(40000)

head(nyc)
```

First Combined Dataset (Pets in Seattle and NYC):
```{r}
names <- bind_rows(seattle, nyc)
names
```

New Categorical Variable: City

```{r}
names <- names %>% 
  mutate(City = ifelse(substr(ZipCode, 1, 1) == 1, "New York City", "Seattle"))

head(names)
```


New Column: Number of Each Distinct Pet Name
```{r}
names <- names %>%
  count(Name) %>%
  mutate(Total = n) %>% 
  select(Name, Total)

head(names)
```

New Dataset: Number of each distinct pet name in Seattle:
```{r}
seattleCount <- seattle %>% 
  count(Name) %>% 
  mutate(Seattle = n) %>% 
  select(Name, Seattle)
head(seattleCount)
```

New Dataset: Number of each distinct pet name in NYC:
```{r}
nycCount <- nyc %>% 
  count(Name) %>% 
  mutate(NYC = n) %>%
  select(Name, NYC)
head(nycCount)
```


Merging: Number of each name in total, in Seattle, and in NYC
```{r}
names <- left_join(names, seattleCount)

names <- left_join(names, nycCount)

names

names <- names %>% 
  mutate(Seattle = ifelse(is.na(Seattle), 0, Seattle))

names <- names %>% 
  mutate(NYC = ifelse(is.na(NYC), 0, NYC))

names <- names %>% 
  arrange(desc(Total)) %>% 
  filter(Name != "Unknown") %>% 
  filter(Name != "Name Not Provided") %>% 
  filter(Name != "None") %>% 
  filter(Name != "Name")

head(names)
```

New Categorical Variable: UniqueTo[City]
** Unique = at least 70% of the instances of a particular name comes from one city

```{r}
names <- names %>% 
  mutate(UniqueToSeattle = ifelse(Seattle / Total >= 0.7, TRUE, FALSE)) %>% 
  mutate(UniqueToNYC = ifelse(NYC / Total >= 0.7, TRUE, FALSE))

head(names)
```


New dataset: Numeric ranking of names in Seattle
```{r}
seattleRank <- seattleCount %>% 
  arrange(desc(Seattle)) %>% 
  mutate(Seattle = row_number())

head(seattleRank)
```


New dataset: Numeric ranking of names in NYC
```{r}
nycRank <- nycCount %>% 
  arrange(desc(NYC)) %>% 
  mutate(NYC = row_number()) %>% 
  filter(Name != "Unknown") %>% 
  filter(Name != "Name Not Provided") %>% 
  filter(Name != "Name")

head(nycRank)
```

New dataset: Overall numeric ranking of names (Seattle & NYC)
```{r}
namesRank <- names %>% 
  mutate(rank = row_number()) %>% 
  select(Name, rank)

head(namesRank)
```

Merging: Numeric ranking of names (Overall, Seattle, NYC)
```{r}
rank <- left_join(namesRank, seattleRank)

rank <- left_join(rank, nycRank)

rank <- rank %>% 
  mutate("OverallRank" = rank) %>% 
  select(Name, OverallRank, Seattle, NYC)

head(rank)
```

New dataset: Seattle Breeds
```{r}
seattleBreeds <- seattle %>% 
  count(Breed) %>% 
  arrange(desc(n))

head(seattleBreeds)
```

New Dataset: NYC Breeds
```{r}
nycBreeds <- nyc %>% 
  count(Breed) %>% 
  arrange(desc(n))

head(nycBreeds)
```


GRAPHS:

Seattle Breeds Chart
```{r}
seattleBreeds %>% 
  head(5) %>%
  ggplot(aes(x = "", n, fill = Breed)) +
  geom_bar(stat = 'identity', width = 1, color="white") +
  coord_polar("y", start = 0) +
  theme_void() +
  labs(title = "Top 5 Pet Breeds in Seattle")
```


NYC Breeds Chart

```{r}
nycBreeds %>% 
  head(5) %>%
  ggplot(aes(x = "", n, fill = Breed)) +
  geom_bar(stat = 'identity', width = 1, color="white") +
  coord_polar("y", start = 0) +
  theme_void() +
  labs(title = "Top 5 Pet Breeds in NYC")
```


Top 10 Names in Seattle
```{r}
seattleCount %>%
  arrange(desc(Seattle)) %>%
  head(10) %>%
  ggplot(aes(x = "", Seattle, fill = Name)) +
  geom_bar(stat = 'identity', width = 1, color="white") +
  coord_polar("y", start = 0) +
  theme_void() +
  labs(title = "Top 10 Names in Seattle")
```

Top 10 Names in NYC
```{r}
nycCount %>%
  filter(Name != "Unknown") %>% 
  filter(Name != "Name Not Provided") %>% 
  arrange(desc(NYC)) %>%
  head(10) %>%
  ggplot(aes(x = "", NYC, fill = Name)) +
  geom_bar(stat = 'identity', width = 1, color="white") +
  coord_polar("y", start = 0) +
  theme_void() +
  labs(title = "Top 10 Names in NYC")
```


City Specific Rankings of Top 5 Names
```{r}
rank %>% 
  head(5) %>% 
  ggplot(aes(Seattle, NYC, col = factor(Name))) +
  geom_point(size = 3) +
  labs(x = "Seattle Ranking", y = "NYC Ranking", col = "Name", title = "Top 5 Pet Names Overall in Seattle and NYC")
```


FINAL SUMMARIZATION TABLE:

```{r}
unique <- names %>% 
  select(Name, UniqueToSeattle, UniqueToNYC)

rank <- left_join(rank, unique)

rank
```


MORE GRAPHS:

Names from the Overall Top Ranking With Notable Popularity Differences
```{r}
rank %>% 
  pivot_longer(c(Seattle, NYC), names_to = "City", values_to = "Rank") %>% 
  select(Name, City, Rank, UniqueToSeattle, UniqueToNYC) %>% 
  filter(UniqueToSeattle == TRUE | UniqueToNYC == TRUE) %>%
  head(10) %>% 
  ggplot(aes(x= Name, y = Rank, fill = factor(City))) +
  geom_bar(stat = 'identity', position = 'dodge') +
  labs(x = "Name", y = "Rank", fill = "City", title = "Names with Notable Popularity Differences")
```
Biggest Popularity Differences in the Top 1000 Overall
```{r}
rank %>%
  head(1000) %>% 
  select(Name, Seattle, NYC) %>% 
  mutate('Difference(SEA-NYC)' = Seattle - NYC) %>%
  arrange(`Difference(SEA-NYC)`) %>% 
  head(5) %>% 
  ggplot(aes(x = Seattle, NYC, col = factor(Name))) +
  geom_point(size = 3) +
  labs(x = "Seattle", y = "NYC", col = "Name",
       title = "Names from the Overall Top 1000 With Significant Popularity Differences")
```
